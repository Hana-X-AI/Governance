# Server Documentation Standard

**Document Type**: Standards - Server Documentation  
**Created**: November 6, 2025  
**Topic**: Standardized documentation structure for all Hana-X servers  
**Purpose**: Define consistent documentation patterns ensuring traceability and operational excellence across all 30 platform servers  
**Classification**: Internal - Governance  

---

## Problem Statement

**Current State** (identified during POC-001):
- Governance docs on control plane ≠ Server reality
- Documentation fragmented across `/srv/cc/Governance/WIP/deployments/` and `/srv/cc/Governance/WIP/Current State/`
- Inconsistency between baseline docs and actual server state
- Example: Docs show "server not operational" but other docs show "100% testing passed"

**Impact**:
- Operators cannot trust documentation
- Wasted time reconciling conflicting information
- No single source of truth for server state
- Difficult to troubleshoot or replicate configurations

---

## Solution: Standardized Server-Side Documentation

**Approach**: **Incremental migration** - bring servers to standard as we touch them

**NOT** creating a separate documentation cleanup project (unless fragmentation becomes painful)

**Motto**: **Aim small, miss small. Keep it simple.**

---

## Standard Directory Structure

**Location**: `/etc/<service>/` (or `/srv/<service>/` where appropriate)

### Proposed Structure

**Naming Convention**: Follow governance standards (kebab-case, lowercase, descriptive)

```
/etc/<service>/
├── configuration/
│   ├── <service>-config.md           # Master configuration documentation
│   ├── <service>-storage-config.md   # Storage/filesystem configuration
│   └── domain-config.md              # Domain integration (LDAP, Kerberos, DNS)
├── deployment-checklist.md           # Quick pre/post deployment checklist
├── deployment-ready.md               # Pre-deployment summary & readiness
└── deployment-postmortem.md          # Post-deployment analysis & lessons learned
```

**Alternative consideration** (for services not in `/etc/`):
```
/srv/<service>/docs/
├── configuration/
│   ├── <service>-config.md
│   ├── <service>-storage-config.md
│   └── domain-config.md
├── deployment-checklist.md
├── deployment-ready.md
└── deployment-postmortem.md
```

**Note**: All filenames use **kebab-case** (lowercase with hyphens) per governance naming standards.

---

## Document Specifications

### 1. Master Configuration (`<service>-config.md`)

**Purpose**: Document the service's primary configuration

**Contents**:
- Service version and install date
- Configuration file locations (with samples/snippets)
- Key configuration parameters explained
- Performance tuning settings
- Security configuration
- Network configuration (ports, bindings)
- Dependencies (other services required)

**Example** (`nginx-config.md`):
```markdown
# Nginx Configuration

**Version**: nginx/1.18.0
**Install Date**: 2025-10-21
**Config Location**: `/etc/nginx/nginx.conf`

## Key Configuration

### SSL/TLS
- **Certificate**: `/etc/nginx/ssl/ssl-cert.crt`
- **Key**: `/etc/nginx/ssl/ssl-cert.key`
- **Protocols**: TLSv1.2, TLSv1.3
- **Ciphers**: ECDHE-RSA-AES256-GCM-SHA384...

### Performance
- **Worker Processes**: 4 (auto)
- **Worker Connections**: 1024
- **Keepalive Timeout**: 65s

### Security Headers
- HSTS: max-age=63072000
- X-Frame-Options: SAMEORIGIN
- CSP: default-src 'self'

## Configuration Files
- Main config: `/etc/nginx/nginx.conf`
- Sites available: `/etc/nginx/sites-available/`
- Sites enabled: `/etc/nginx/sites-enabled/`

## Reload Procedure
```bash
nginx -t && systemctl reload nginx
```
```

---

### 2. Storage Configuration (`<service>-storage-config.md`)

**Purpose**: Document filesystem, storage, and data locations

**Contents**:
- Data directories
- Log locations
- Backup locations
- Disk space requirements
- Mount points (if applicable)
- Storage quotas/limits

**Example** (`nginx-storage-config.md`):
```markdown
# Nginx Storage Configuration

## Data Locations

### Web Content
- **Root**: `/var/www/html/`
- **Size**: ~2MB (static HTML)

### Logs
- **Access Log**: `/var/log/nginx/access.log`
- **Error Log**: `/var/log/nginx/error.log`
- **Rotation**: logrotate (7 days retention)

### Operations Log
- **Location**: `/var/log/hx-ssl-server-operations.log`
- **Purpose**: Manual operations audit trail

## Disk Space
- **Current Usage**: <1GB
- **Recommended**: 5GB minimum
- **Monitoring**: Check /var partition

## Backups
- **Config Backup**: Daily automated (Ansible)
- **Location**: `/srv/backups/nginx/`
```

---

### 3. Domain Configuration (`domain-config.md`)

**Purpose**: Document integration with Hana-X domain services

**Contents**:
- LDAP configuration (if applicable)
- Kerberos configuration (if applicable)
- DNS records
- Service accounts
- Authentication methods

**Example** (`domain-config.md`):
```markdown
# Domain Integration Configuration

## DNS Records
- **A Record**: hx-ssl-server.hx.dev.local → 192.168.10.202
- **PTR Record**: 192.168.10.202 → hx-ssl-server.hx.dev.local
- **CNAME**: (none currently)

## Service Account
- **User**: nginx-service@hx.dev.local (if needed - currently not used)
- **Purpose**: (N/A for current nginx setup)

## Authentication
- **Type**: None (static content server, no auth required)
- **Future**: May integrate with LDAP for protected content

## Domain Services Used
- **DNS**: hx-dc-server (192.168.10.200)
- **NTP**: hx-dc-server (192.168.10.200)
```

---

### 4. Deployment Checklist (`deployment-checklist.md`)

**Purpose**: Quick reference checklist for deployments

**Contents**:
- Pre-deployment checks
- Deployment steps
- Post-deployment validation
- Rollback procedure

**Example**:
```markdown
# Nginx Deployment Checklist

## Pre-Deployment
- [ ] DNS record exists
- [ ] SSL certificate available
- [ ] Disk space adequate (5GB+ free)
- [ ] Firewall rules configured (ports 80, 443)
- [ ] Domain services accessible (DNS, NTP)

## Deployment
- [ ] Install nginx package (`apt install nginx`)
- [ ] Copy SSL certificates to `/etc/nginx/ssl/`
- [ ] Deploy nginx.conf
- [ ] Test configuration (`nginx -t`)
- [ ] Enable service (`systemctl enable nginx`)
- [ ] Start service (`systemctl start nginx`)

## Post-Deployment Validation
- [ ] Service running (`systemctl status nginx`)
- [ ] Ports listening (`ss -tlnp | grep nginx`)
- [ ] HTTP response (`curl http://localhost/`)
- [ ] HTTPS response (`curl -k https://localhost/`)
- [ ] Logs clean (no errors in `/var/log/nginx/error.log`)

## Rollback Procedure
- [ ] Stop nginx (`systemctl stop nginx`)
- [ ] Restore previous config from backup
- [ ] Test config (`nginx -t`)
- [ ] Start nginx (`systemctl start nginx`)
```

---

### 5. Deployment Ready (`deployment-ready.md`)

**Purpose**: Pre-deployment summary confirming readiness

**Contents**:
- Prerequisites confirmed
- Resources allocated
- Dependencies verified
- Risk assessment
- Go/No-Go decision

**Example**:
```markdown
# Deployment Readiness Summary

**Service**: Nginx (hx-ssl-server)
**Date**: 2025-10-21
**Deploying Agent**: @agent-william
**Status**: READY

## Prerequisites Verified
- ✅ Server provisioned (192.168.10.202)
- ✅ DNS configured (hx-ssl-server.hx.dev.local)
- ✅ SSL certificates generated
- ✅ Firewall rules applied
- ✅ Disk space adequate (50GB available)

## Dependencies
- ✅ hx-dc-server operational (DNS, NTP)
- ✅ Network connectivity confirmed
- ✅ Domain services accessible

## Resources Allocated
- **CPU**: 2 cores
- **RAM**: 4GB
- **Disk**: 50GB
- **Network**: 192.168.10.202/24

## Risk Assessment
- **Risk Level**: LOW
- **Rollback**: Easy (stop service, restore config)
- **Downtime**: 0 (new service, no existing traffic)

## Go/No-Go Decision
**GO** - All prerequisites met, low risk, rollback available

**Authorized By**: CAIO
**Date**: 2025-10-21
```

---

### 6. Deployment Postmortem (`deployment-postmortem.md`)

**Purpose**: Post-deployment analysis and lessons learned

**Contents**:
- Deployment timeline
- Issues encountered
- Resolutions applied
- Current operational status
- Lessons learned
- Recommendations

**Example**:
```markdown
# Nginx Deployment Postmortem

**Service**: Nginx (hx-ssl-server)
**Deployment Date**: 2025-10-21
**Deployed By**: @agent-william
**Status**: OPERATIONAL

## Timeline
- 2025-10-21 17:30: Server provisioned
- 2025-10-21 17:45: Nginx installed
- 2025-10-21 17:49: Service started (initial start)
- 2025-10-21 18:25: Config updated (reverse proxy planning)
- 2025-11-06 02:51: Config reloaded (POC-001 - applied Oct 21 changes)

## Issues Encountered

### Issue 1: Config Not Reloaded
- **Problem**: Config updated Oct 21 18:25 but service not reloaded
- **Impact**: 36 minutes of config changes not applied
- **Duration**: 15 days (until POC-001 on Nov 6)
- **Resolution**: POC-001 reload operation (Nov 6 02:51)
- **Root Cause**: Manual config edit, forgot reload step
- **Prevention**: Add reload to deployment checklist

## Current Status
- **Service**: Active (running)
- **Last Reload**: 2025-11-06 02:51:18
- **Uptime**: 15+ days (original start Oct 21)
- **Response**: HTTP/2 200 OK
- **Errors**: 0 (logs clean)

## Lessons Learned

### What Went Well
- Service started successfully on first try
- SSL/TLS working as expected
- Security headers configured correctly

### What Could Be Improved
- **Config Reload Tracking**: Need reminder to reload after edits
- **Validation**: Should check "Active since" vs "config modified" timestamps
- **Documentation**: Should document config changes as they happen

### Recommendations
1. Add "nginx reload validation" to operations playbook
2. Create Ansible playbook for nginx config deployment (auto-reload)
3. Monitor config file modification timestamps vs service reload timestamps

## Related Work
- **POC-001**: Nginx config reload (2025-11-06) - See `/srv/cc/Governance/x-poc1/`
```

---

## Migration Strategy

**Principle**: **Incremental**, not big-bang

### Approach

**When we touch a server** (deployment, configuration change, troubleshooting):
1. Create server documentation directory (if not exists)
2. Create applicable documents from templates above
3. Document current state (as-is)
4. Update during work execution
5. Mark server as "documentation compliant" in governance

**NOT**:
- ❌ Separate "documentation cleanup" project (unless becomes painful)
- ❌ Documenting servers we're not actively working on
- ❌ Perfection (aim for "good enough", iterate)

### Phasing

**Phase 1** (Next 5 POCs/projects):
- Bring 5 servers to standard as we work on them
- Refine templates based on real-world use
- Collect feedback from agents

**Phase 2** (After 5 POCs):
- Review template effectiveness
- Decide: Continue incremental OR launch doc cleanup project
- Update this standard based on lessons learned

**Phase 3** (Long-term):
- All 30 servers documented to standard
- Automated compliance checking
- Integration with Ansible for auto-documentation

---

## Current Documentation Location (Transitional)

**During migration**, documentation exists in multiple places:

### Control Plane (Current)
- `/srv/cc/Governance/WIP/deployments/servers/<server-name>/`
- `/srv/cc/Governance/WIP/Current State/<server-name>-baseline.md`

### Server-Side (Target)
- `/etc/<service>/` OR `/srv/<service>/docs/` (per this standard)

### POC Work (Temporary)
- `/srv/cc/Governance/x-poc<N>/` (ephemeral, project-specific)

**Reconciliation**:
- As servers are touched, migrate control plane docs → server-side docs
- Mark control plane docs as "DEPRECATED - See server-side docs at <location>"
- Eventually retire WIP directory (when all servers migrated)

---

## Success Criteria

**Server is "documentation compliant" when**:

✅ Server-side documentation directory exists  
✅ At minimum: `deployment-postmortem.md` present (proves deployment documented)  
✅ Configuration documents reflect actual server state  
✅ Operations guide available (how to manage service)  
✅ Marked as compliant in Platform Nodes document

**Measurement**:
- Track: X of 30 servers documented (incremental progress)
- Goal: 100% compliance (long-term)

---

## Template Access

**Templates** (in this document):
- Master Configuration template
- Storage Configuration template
- Domain Configuration template
- Deployment Checklist template
- Deployment Ready template
- Deployment Postmortem template

**Usage**:
- Agents copy relevant sections when documenting servers
- Customize to service-specific needs
- Keep it simple (don't over-document)

---

## Integration with POC Workflow

**During POC execution**:

**T-0.1** (New pre-flight task for server-touching POCs):
```markdown
**T-0.1**: Verify/create server documentation directory
- Command: ssh target "sudo mkdir -p /etc/<service>/ || sudo mkdir -p /srv/<service>/docs/"
- Purpose: Ensure directory exists before POC file operations
- Status: Standard pre-flight check
```

**Post-POC** (Phase 5):
- Update/create `deployment-postmortem.md` with POC work
- Document configuration changes made
- Update operations guidance if needed

---

## Governance Compliance

**This standard is**:
- **Aspirational**: Target state for all servers
- **Incremental**: Achieved over time as servers are touched
- **Flexible**: Templates can be customized per service type
- **Simple**: Aim small, miss small (don't over-engineer)

**This standard is NOT**:
- **Mandatory immediately**: Not blocking current work
- **Rigid**: Adjust templates as needed based on experience
- **Perfect**: "Good enough and improving" over "perfect and never done"

---

## POC-001 Lessons Applied

**Lesson**: Directory structure didn't exist on hx-ssl-server
**Solution**: T-0.1 pre-flight task to create structure

**Lesson**: Control plane docs ≠ Server reality
**Solution**: Server-side docs as source of truth

**Lesson**: Fragmented documentation across WIP directories
**Solution**: Standardized location and structure

---

## CAIO Feedback Integration

**CAIO stated**:
> "We must use this documentation with caution as in many cases it shows the server not operational but others docs show 100% testing passed"

**This standard addresses**:
- Single source of truth (server-side, not fragmented)
- Living documentation (updated as work happens)
- Reconciliation path (migrate WIP → server-side incrementally)

**CAIO proposed structure** (incorporated above with naming standard compliance):
```
/etc/<service>/
├── configuration/
│   ├── <service>-config.md
│   ├── <service>-storage-config.md
│   └── domain-config.md
├── deployment-checklist.md
├── deployment-ready.md
└── deployment-postmortem.md
```

**Naming Alignment**: All filenames updated to follow governance naming standards (kebab-case, lowercase)

**CAIO also stated**: "Open for discussions"
- This v1.0 is starting point
- Refine based on real-world use (next 5 POCs)
- Adjust structure if needed

---

## Next Steps

1. **Use in next POC**: Apply standard to next server-touching work
2. **Collect feedback**: How well do templates work?
3. **Refine v1.1**: Update standard after 2-3 POCs
4. **Track compliance**: Monitor X of 30 servers documented
5. **Decide migration**: After 5 POCs, evaluate incremental vs project approach

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-11-06 | Initial server documentation standard based on CAIO directive from POC-001 lessons learned | Agent Zero |

---

**Version**: 1.0  
**Maintained By**: Agent Zero (with CAIO review)  
**Related Documents**:  
- [Work Methodology](../0.0.1-Planning/0.0.1.3-work-methodology.md) - References in Phase 5  
- [Platform Nodes](./0.0.2.1-platform-nodes.md) - Server inventory  
- [Naming Standards](../0.0.1-Planning/0.0.1.0-naming-standards.md)  
**Classification**: Internal - Governance  
**Status**: ACTIVE - Incremental implementation  
**Last Review**: November 6, 2025

---

*"Single source of truth, incrementally achieved. Aim small, miss small."*

**END OF SERVER DOCUMENTATION STANDARD**
