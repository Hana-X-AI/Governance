# Agent Selection Guide

**Purpose**: Help Agent Zero (and future orchestrators) select the correct specialist agent for any given task

**Version**: 1.0
**Date**: 2025-11-06
**Authority**: Derived from Agent Catalog and POC-001 lessons learned

---

## Quick Decision Flowchart

```
Is this work...

├─ Infrastructure/Identity Related?
│  ├─ DNS, LDAP, Kerberos, FreeIPA, Domain Services? → @agent-frank
│  ├─ SSL/TLS Certificates, PKI, CA Operations? → @agent-frank
│  └─ SSH Keys, User/Group Management, Authentication? → @agent-frank
│
├─ System Operations Related?
│  ├─ Ubuntu OS, systemd, package management? → @agent-william
│  ├─ Nginx operations (config, reload, restart)? → @agent-william
│  ├─ Service management (start/stop/status)? → @agent-william
│  └─ File system, permissions, cron jobs? → @agent-william
│
├─ Automation/Configuration Management?
│  ├─ Ansible playbooks, roles, automation? → @agent-amanda
│  ├─ Fleet-wide config updates? → @agent-amanda
│  └─ Infrastructure as code? → @agent-amanda
│
├─ Container/Orchestration?
│  └─ Docker, containers, images? → @agent-yasmin
│
├─ Model & Inference Layer?
│  ├─ Ollama models, embeddings? → @agent-patricia
│  ├─ LiteLLM routing, API gateway? → @agent-maya
│  └─ Langchain orchestration? → @agent-laura
│
├─ Data Plane?
│  ├─ PostgreSQL databases? → @agent-quinn
│  ├─ Redis caching? → @agent-samuel
│  ├─ Qdrant vector DB? → @agent-robert
│  └─ Qdrant UI? → @agent-sarah
│
├─ Agentic & Toolchain Layer?
│  ├─ FastMCP gateway? → @agent-george
│  ├─ QMCP server? → @agent-kevin
│  ├─ Crawl4AI MCP orchestration? → @agent-david
│  ├─ Crawl4AI worker execution? → @agent-diana
│  ├─ Docling MCP? → @agent-eric
│  ├─ Docling worker? → @agent-elena
│  ├─ LightRAG knowledge graphs? → @agent-marcus
│  └─ N8N MCP? → @agent-olivia
│
├─ Application Layer?
│  ├─ Open WebUI? → @agent-paul
│  ├─ CopilotKit? → @agent-hannah
│  ├─ AG-UI protocol? → @agent-brian
│  ├─ N8N workflows? → @agent-omar
│  ├─ Next.js apps? → @agent-victor
│  └─ FastAPI development? → @agent-fatima
│
└─ Integration & Governance?
   ├─ GitHub Actions, CI/CD? → @agent-isaac
   ├─ Testing, QA validation? → @agent-julia
   ├─ Metrics, monitoring? → @agent-nathan
   ├─ Object storage (Minio)? → @agent-alex
   └─ Code review (CodeRabbit)? → @agent-carlos
```

---

## Critical Distinctions

### Frank vs William: Infrastructure vs Operations

**Common Confusion**: SSL server work - who handles it?

**Answer**: **It depends on WHAT aspect**

| Task | Correct Agent | Why |
|------|---------------|-----|
| Generate SSL/TLS certificates | **@agent-frank** | Certificate authority (PKI) operations |
| Deploy certificates to nginx | **@agent-william** | Nginx configuration (copy files, update config) |
| Reload nginx after cert update | **@agent-william** | Service operation (systemctl reload) |
| Troubleshoot certificate validation | **@agent-frank** | Certificate chain, CA, trust issues |
| Configure nginx SSL directives | **@agent-william** | Nginx configuration syntax |
| Set up LDAP authentication for service | **@agent-frank** | Identity & authentication infrastructure |
| Restart service after auth config | **@agent-william** | Service operation |

**Rule of Thumb**:
- **Frank**: "What" (certificates, identities, DNS records)
- **William**: "How" (configure, restart, manage services)

**POC-001 Example**:
- Task: Reload nginx configuration
- Initial assignment: @agent-frank (WRONG - thought "SSL server = Frank")
- Correct assignment: @agent-william (nginx service operation)
- Frank correctly identified: "Not my domain, recommend William"

---

### Server Ownership Matrix

**Use this to verify agent has the right server access**

#### Frank Lucas (@agent-frank) - Infrastructure Specialist
**Assigned Servers**:
- hx-freeipa-server (192.168.10.200)
- hx-freeipa-replica (192.168.10.201)

**Can work on**: ANY server for DNS, LDAP, certificate deployment (cross-server)

#### William Taylor (@agent-william) - Ubuntu Systems Administrator
**Assigned Servers**: **ALL 30 Ubuntu servers** (fleet-wide responsibility)

**Primary role**: System-level operations (OS, systemd, packages, services)

#### All Other Agents
**Server-specific**: Each agent owns their service's server(s)
- Example: Patricia owns hx-ollama1-server, hx-ollama2-server
- Example: Robert owns hx-qdrant-server

**Reference**: `/srv/cc/Governance/0.1-agents/agent-catalog.md` - Server ownership column

---

## Common Scenarios with Correct Assignments

### Scenario 1: Nginx Configuration Reload

**Task**: "Reload nginx to apply config changes"

**Wrong thinking**: "SSL server → Frank"
**Correct thinking**: "Service operation → William"

**Agent**: @agent-william

**Rationale**:
- Nginx is a service (systemctl reload nginx)
- Service operations are William's domain
- Frank handles certificates, not service management

**POC-001 Validation**: ✅ This pattern worked

---

### Scenario 2: Deploy New SSL Certificate

**Task**: "Generate and deploy new SSL certificate for hx-webui-server"

**Multi-agent coordination required**:
1. **@agent-frank**: Generate certificate from CA
2. **@agent-william**: Copy cert to server, update nginx config, reload service

**Rationale**: Certificate generation (Frank) + service configuration (William)

---

### Scenario 3: Add DNS Record

**Task**: "Add DNS A record for new service"

**Agent**: @agent-frank

**Rationale**:
- DNS is part of FreeIPA infrastructure
- Frank owns domain services
- Uses `samba-tool dns` commands

---

### Scenario 4: Install Package on Server

**Task**: "Install Redis on hx-redis-server"

**Coordination**:
1. **@agent-william**: Install package (`apt install redis-server`)
2. **@agent-samuel**: Configure Redis service (redis.conf, performance tuning)

**Rationale**: OS-level install (William) + service-specific config (Samuel)

---

### Scenario 5: Deploy Ollama Model

**Task**: "Download and configure llama3.2 model"

**Agent**: @agent-patricia

**Rationale**:
- Ollama model management
- Patricia owns Ollama infrastructure
- Has knowledge source: `/srv/knowledge/vault/ollama/`

---

### Scenario 6: Flask-Wide Ansible Automation

**Task**: "Update SSH config across all servers using Ansible"

**Agent**: @agent-amanda

**Rationale**:
- Ansible automation
- Fleet-wide orchestration
- Amanda owns hx-control-node

---

### Scenario 7: LightRAG Query Optimization

**Task**: "Improve LightRAG query performance"

**Agent**: @agent-marcus

**Rationale**:
- LightRAG knowledge graph operations
- Marcus owns LightRAG service
- Has knowledge source: `/srv/knowledge/vault/lightrag/`

---

### Scenario 8: GitHub Actions Pipeline

**Task**: "Set up CI/CD pipeline for testing"

**Agent**: @agent-isaac

**Rationale**:
- CI/CD operations
- Isaac owns GitHub Actions integration

---

### Scenario 9: CodeRabbit Code Review

**Task**: "Enable automated code reviews on PRs"

**Agent**: @agent-carlos

**Rationale**:
- CodeRabbit MCP server operations
- Carlos owns code review automation

---

### Scenario 10: Web Scraping for RAG Corpus

**Task**: "Crawl documentation site for knowledge base"

**Coordination**:
1. **@agent-david**: Orchestrate crawl via Crawl4AI MCP
2. **@agent-diana**: Execute crawl with Crawl4AI worker
3. **@agent-marcus**: Ingest into LightRAG knowledge graph

**Rationale**: MCP orchestration (David) + worker execution (Diana) + RAG integration (Marcus)

---

## Agent Validation Protocol

**When assigning an agent, confirm**:

1. ✅ **Domain Match**: Task is within agent's expertise
2. ✅ **Server Access**: Agent owns or can access the affected server(s)
3. ✅ **Knowledge Source**: Agent has knowledge vault for this domain (if applicable)
4. ✅ **Dependencies**: Identify any multi-agent coordination needed

**Phase 3 Alignment Check**: Agent must confirm "This IS my domain" (or flag if wrong)

---

## When in Doubt

**Escalation for Unclear Assignments**:

1. **Check Agent Catalog**: `/srv/cc/Governance/0.1-agents/agent-catalog.md`
   - Service ownership matrix
   - Architecture layer mapping

2. **Check Agent Profiles**: `/srv/cc/Governance/0.1-agents/agent-[name].md`
   - Detailed responsibilities
   - Server assignments
   - Integration points

3. **Use Phase 3 Alignment**: Assign "best guess" agent, let them validate/correct
   - Agent will flag if wrong domain
   - Recommend correct agent
   - Reassign and restart Phase 3

4. **Escalate to CAIO**: If still unclear after agent review

---

## Multi-Agent Work Patterns

### Pattern 1: Infrastructure + Operations

**Example**: SSL certificate deployment

**Agents**: @agent-frank (certs) + @agent-william (config)

**Sequence**:
1. Frank generates certificate
2. William deploys to nginx
3. William reloads service
4. Frank validates certificate trust chain

---

### Pattern 2: Model + Service + Storage

**Example**: RAG pipeline setup

**Agents**: @agent-patricia (Ollama) + @agent-elena (Docling) + @agent-robert (Qdrant) + @agent-marcus (LightRAG)

**Sequence**:
1. Patricia ensures embedding model available
2. Elena processes documents
3. Robert stores vectors
4. Marcus builds knowledge graph

---

### Pattern 3: MCP Orchestrator + Worker

**Example**: Web scraping job

**Agents**: @agent-david (Crawl4AI MCP) + @agent-diana (Crawl4AI Worker)

**Pattern**:
- David validates request, enforces policies
- Diana executes crawl
- David coordinates with downstream consumers

---

## Knowledge-Expert Agents

**Agents with `/srv/knowledge/vault/` sources** (Agent Zero must review these BEFORE drafting specs):

| Agent | Knowledge Source | Domain |
|-------|------------------|--------|
| @agent-william | /srv/knowledge/vault/nginx/ | Nginx operations |
| @agent-patricia | /srv/knowledge/vault/ollama/ | Ollama models |
| @agent-marcus | /srv/knowledge/vault/lightrag/ | LightRAG knowledge graphs |
| @agent-amanda | /srv/knowledge/vault/ansible-devel/ | Ansible automation |
| Others | (To be added as knowledge sources grow) | Various |

**Process** (from Methodology v1.2):
1. Agent Zero identifies knowledge-expert agent needed
2. Agent Zero reviews their knowledge source FIRST
3. Agent Zero drafts specification grounded in expert knowledge
4. Agent reviews and enhances (not corrects major gaps)

---

## Success Metrics

**Agent assignment is successful when**:

✅ Agent confirms "This is my domain" in Phase 3
✅ Agent has server access needed
✅ Agent has knowledge sources (if applicable)
✅ No reassignment needed
✅ Execution succeeds without escalation

**Agent assignment needs improvement when**:

⚠️ Agent flags "Wrong domain" in Phase 3 (but caught = framework working!)
⚠️ Agent lacks server access (infrastructure issue)
⚠️ Agent unfamiliar with technology (knowledge gap)
❌ Wrong agent executes (Phase 3 skipped - governance failure)

---

## POC-001 Lessons Applied

**Lesson**: Frank correctly identified wrong assignment
**Outcome**: Phase 3 Alignment caught error before execution
**Framework Validation**: Multi-agent review prevents failures

**Updated Process**:
1. Agent Zero uses this guide for initial assignment
2. Phase 3 agents validate assignment
3. Agents flag if wrong domain
4. Agent Zero reassigns if needed
5. **This is expected and good** - not a failure

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-11-06 | Initial agent selection guide based on POC-001 lessons learned and Agent Catalog | Agent Zero |

---

**Version**: 1.0  
**Maintained By**: Agent Zero  
**Related Documents**:  
- [Agent Catalog](../../0.1-agents/agent-catalog.md) - Source of agent domains  
- [Agent Persona Reference](./0.0.1.6-agent-persona-reference.md) - Quick lookup  
- [Work Methodology](./0.0.1.3-work-methodology.md) - References in Phase 0  
**Classification**: Internal - Governance  
**Status**: ACTIVE - Decision support for agent selection  
**Last Review**: November 6, 2025

---

*"When in doubt, use Phase 3 Alignment. Agents know their boundaries."*

**END OF AGENT SELECTION GUIDE**
