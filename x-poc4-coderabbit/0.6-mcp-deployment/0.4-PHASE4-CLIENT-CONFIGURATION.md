# Roger MCP Server - Phase 4.0 Client Configuration

**Document Type**: Technical Documentation - Client Setup  
**Created**: November 11, 2025  
**Target Servers**: All Hana-X servers with Claude Code  
**MCP Server**: hx-coderabbit-server.hx.dev.local (192.168.10.228:8005)  
**Phase**: 4.0 - Network-Accessible MCP Server  
**Status**: Client Configuration Guide  
**Classification**: Internal - Technical Documentation

---

## Document Purpose

This document provides comprehensive instructions for configuring Claude Code clients across the Hana-X infrastructure to connect to the centralized Roger MCP server. It covers client prerequisites, configuration steps, connection testing, troubleshooting, and usage examples for accessing Roger's code review capabilities from any Hana-X server.

---

## Table of Contents

1. [Overview](#1-overview)
2. [Architecture](#2-architecture)
3. [Prerequisites](#3-prerequisites)
4. [Client Configuration](#4-client-configuration)
5. [Connection Testing](#5-connection-testing)
6. [Multi-Server Deployment](#6-multi-server-deployment)
7. [Usage Examples](#7-usage-examples)
8. [Troubleshooting](#8-troubleshooting)
9. [Security Considerations](#9-security-considerations)
10. [Best Practices](#10-best-practices)
11. [Appendix](#11-appendix)

---

## 1. Overview

### 1.1 What This Document Covers

This document explains how to configure Claude Code clients on Hana-X servers to access Roger's code review capabilities remotely via the MCP (Model Context Protocol).

**In Scope:**
- Claude Code MCP client configuration
- Network connectivity setup
- Connection testing and validation
- Multi-server deployment strategies
- Usage examples and workflows
- Troubleshooting common issues

**Out of Scope:**
- Roger MCP server setup (see PHASE4-PREREQUISITES-SETUP.md)
- Roger implementation details (see POC4-PHASE3-COMPLETION-REPORT.md)
- MCP protocol internals (see MCP specification)

### 1.2 Target Audience

This document is intended for:
- **System Administrators** deploying Claude Code across Hana-X infrastructure
- **Developers** using Claude Code for code review workflows
- **Agent Zero** orchestrating multi-agent deployments
- **DevOps Engineers** managing CI/CD pipelines with Roger integration

### 1.3 Before You Begin

**Prerequisites Checklist:**
- [ ] Roger MCP Server deployed on hx-coderabbit-server (192.168.10.228)
- [ ] Roger MCP Server running and accessible on port 8005
- [ ] Client server has network access to 192.168.10.0/24
- [ ] Claude Code installed on client server
- [ ] Client server domain-joined to hx.dev.local
- [ ] User has permissions to modify Claude Code configuration

---

## 2. Architecture

### 2.1 Client-Server Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hana-X Infrastructure (192.168.10.0/24)                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Roger MCP Server                                   â”‚   â”‚
â”‚  â”‚  hx-coderabbit-server (192.168.10.228)             â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  HTTP/SSE Transport (Port 8005)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - SSE endpoint: /sse                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Health check: /health                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                        â”‚                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Roger Core (Layer 1 + Layer 3)            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - 6 linters (bandit, pylint, mypy, etc.)  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - CodeRabbit API integration               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Redis cache                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - Rate limiting                            â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â–²                              â”‚
â”‚                             â”‚ MCP over HTTP/SSE            â”‚
â”‚                             â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Client Servers          â”‚                      â”‚      â”‚
â”‚  â”‚                          â”‚                      â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
â”‚  â”‚  â”‚  Claude Code + MCP Client          â”‚        â”‚      â”‚
â”‚  â”‚  â”‚                                    â”‚        â”‚      â”‚
â”‚  â”‚  â”‚  Configuration:                   â”‚        â”‚      â”‚
â”‚  â”‚  â”‚  {                                 â”‚        â”‚      â”‚
â”‚  â”‚  â”‚    "mcpServers": {                â”‚        â”‚      â”‚
â”‚  â”‚  â”‚      "roger": {                   â”‚        â”‚      â”‚
â”‚  â”‚  â”‚        "transport": "sse",        â”‚        â”‚      â”‚
â”‚  â”‚  â”‚        "url": "http://192.168... â”‚        â”‚      â”‚
â”‚  â”‚  â”‚      }                            â”‚        â”‚      â”‚
â”‚  â”‚  â”‚    }                              â”‚        â”‚      â”‚
â”‚  â”‚  â”‚  }                                â”‚        â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
â”‚  â”‚                                                â”‚      â”‚
â”‚  â”‚  Examples:                                     â”‚      â”‚
â”‚  â”‚  â€¢ hx-cc-server (192.168.10.224)              â”‚      â”‚
â”‚  â”‚  â€¢ hx-dev-server (192.168.10.222)             â”‚      â”‚
â”‚  â”‚  â€¢ hx-demo-server (192.168.10.223)            â”‚      â”‚
â”‚  â”‚  â€¢ Any Hana-X server with Claude Code         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Communication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client       â”‚                                  â”‚ Roger MCP    â”‚
â”‚ (Claude Code)â”‚                                  â”‚ Server       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚
       â”‚ 1. Establish SSE Connection                    â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚    GET /sse HTTP/1.1                           â”‚
       â”‚    Host: 192.168.10.228:8005                   â”‚
       â”‚                                                 â”‚
       â”‚ 2. SSE Connection Established                  â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚    HTTP/1.1 200 OK                             â”‚
       â”‚    Content-Type: text/event-stream             â”‚
       â”‚                                                 â”‚
       â”‚ 3. Send MCP Request (initialize)               â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚    POST to SSE channel                         â”‚
       â”‚    {"jsonrpc": "2.0", "method": "initialize"}  â”‚
       â”‚                                                 â”‚
       â”‚ 4. Receive MCP Response                        â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚    Server capabilities, available tools        â”‚
       â”‚                                                 â”‚
       â”‚ 5. Send Tool Call Request (roger_review)       â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚    {"method": "tools/call",                    â”‚
       â”‚     "params": {"name": "roger_review"}}        â”‚
       â”‚                                                 â”‚
       â”‚ 6. Roger Executes Review                       â”‚
       â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚                                          â”‚ Layer 1     â”‚
       â”‚                                          â”‚ Linters     â”‚
       â”‚                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â”‚                                          â”‚ Layer 3     â”‚
       â”‚                                          â”‚ CodeRabbit  â”‚
       â”‚                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚
       â”‚ 7. Receive Tool Call Response                  â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚    Code review results (findings, metrics)     â”‚
       â”‚                                                 â”‚
       â”‚ 8. Display Results to User                     â”‚
       â”‚                                                 â”‚
       â”‚ 9. Keep-alive / Connection Management          â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                                 â”‚
```

### 2.3 Benefits of Centralized MCP Server

**For Users:**
- âœ… No need to SSH to hx-cc-server
- âœ… Access Roger from any development environment
- âœ… Natural language interface via Claude Code
- âœ… Consistent code review experience across all servers

**For Infrastructure:**
- âœ… Single Roger installation (DRY principle)
- âœ… Centralized cache (Redis) reduces API calls
- âœ… Centralized rate limiting
- âœ… Single point of configuration management
- âœ… Easier monitoring and logging

**For Operations:**
- âœ… Simplified deployment (one server vs. many)
- âœ… Easier updates and maintenance
- âœ… Centralized logs for debugging
- âœ… Better resource utilization

---

## 3. Prerequisites

### 3.1 Server Requirements

Each client server must meet the following requirements:

**Operating System:**
- Ubuntu 24.04 LTS (or compatible)
- Kernel 6.x+

**Network:**
- Connected to Hana-X internal network (192.168.10.0/24)
- Can resolve hx.dev.local domain names
- Can reach 192.168.10.228:8005 (TCP)

**Software:**
- Claude Code installed and functional
- Git installed (for code repository access)
- Standard development tools

**Permissions:**
- User can modify Claude Code configuration
- User can read/write to project directories

### 3.2 Roger MCP Server Requirements

Before configuring clients, verify Roger MCP Server is ready:

```bash
# From any Hana-X server, verify Roger is accessible

# 1. Test DNS resolution
nslookup hx-coderabbit-server.hx.dev.local
# Expected: 192.168.10.228

# 2. Test network connectivity
ping -c 3 192.168.10.228

# 3. Test port accessibility
nc -zv 192.168.10.228 8005
# Expected: Connection to 192.168.10.228 8005 port [tcp/*] succeeded!

# 4. Test HTTP endpoint (health check)
curl http://192.168.10.228:8005/health
# Expected: {"status":"healthy","version":"4.0.0",...}

# 5. Test SSE endpoint (connection test)
curl -N http://192.168.10.228:8005/sse
# Expected: SSE stream (will hang - this is correct, press Ctrl+C)
```

**If any test fails**, do not proceed with client configuration. Fix the server-side issue first (see PHASE4-PREREQUISITES-SETUP.md).

### 3.3 Claude Code Installation Verification

Verify Claude Code is installed and operational on the client server:

```bash
# Check if Claude Code is installed
claude-code --version

# Expected output (example):
# claude-code version 1.x.x

# Check Claude Code is in PATH
which claude-code

# Locate Claude Code configuration directory
ls -la ~/.config/claude-code/

# Expected:
# config.json (or similar configuration file)
```

**If Claude Code is not installed:**
```bash
# Installation steps depend on your distribution method
# Consult Claude Code installation documentation
# Typical installation:
# curl -fsSL https://anthropic.com/install/claude-code.sh | bash
```

---

## 4. Client Configuration

### 4.1 Configuration File Location

Claude Code uses JSON configuration for MCP servers. The configuration file location varies by installation:

**Standard Location (Linux/macOS):**
```
~/.config/claude-code/config.json
```

**Alternative Locations:**
```
~/.claude-code/config.json
~/Library/Application Support/claude-code/config.json (macOS)
%APPDATA%\claude-code\config.json (Windows, if applicable)
```

**Find your config file:**
```bash
# Search for config file
find ~ -name "config.json" -path "*claude-code*" 2>/dev/null

# Or check environment variable (if set)
echo $CLAUDE_CODE_CONFIG
```

### 4.2 Basic Configuration

#### 4.2.1 Initial Configuration (No Existing MCP Servers)

If this is your first MCP server, create a new configuration:

```bash
# Create config directory if it doesn't exist
mkdir -p ~/.config/claude-code

# Create config.json with Roger MCP server
cat > ~/.config/claude-code/config.json <<'EOF'
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000
    }
  }
}
EOF

# Verify configuration created
cat ~/.config/claude-code/config.json
```

#### 4.2.2 Adding to Existing Configuration

If you already have MCP servers configured, add Roger to the existing configuration:

```bash
# Backup existing configuration
cp ~/.config/claude-code/config.json ~/.config/claude-code/config.json.backup

# Edit configuration (use your preferred editor)
nano ~/.config/claude-code/config.json
# or
vim ~/.config/claude-code/config.json
```

**Add the Roger entry:**

```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000
    },
    "existing-server-1": {
      "transport": "...",
      "url": "..."
    },
    "existing-server-2": {
      "transport": "...",
      "url": "..."
    }
  }
}
```

**Configuration Options Explained:**

| Field | Value | Purpose |
|-------|-------|---------|
| `transport` | `"sse"` | Use Server-Sent Events (HTTP streaming) |
| `url` | `"http://192.168.10.228:8005/sse"` | Roger MCP server SSE endpoint |
| `timeout` | `300000` | Connection timeout in milliseconds (5 minutes) |

### 4.3 Advanced Configuration Options

For more control over the connection, you can add optional parameters:

```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000,
      "retries": 3,
      "retryDelay": 1000,
      "keepAlive": true,
      "headers": {
        "User-Agent": "claude-code-client/1.0"
      }
    }
  }
}
```

**Advanced Options:**

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `retries` | integer | 3 | Number of connection retry attempts |
| `retryDelay` | integer | 1000 | Delay between retries (milliseconds) |
| `keepAlive` | boolean | true | Maintain persistent connection |
| `headers` | object | {} | Custom HTTP headers for requests |

**Note:** Advanced options may not be supported by all Claude Code versions. Test before relying on them.

### 4.4 Using FQDN vs IP Address

You can configure Roger using either the IP address or FQDN:

**Option 1: IP Address (Direct)**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000
    }
  }
}
```

**Option 2: FQDN (DNS-Based)**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://hx-coderabbit-server.hx.dev.local:8005/sse",
      "timeout": 300000
    }
  }
}
```

**Recommendation:**
- Use **FQDN** for production (better maintainability if IP changes)
- Use **IP address** for testing/debugging (eliminates DNS as variable)

### 4.5 Environment-Specific Configurations

For different environments (dev, staging, production), you can maintain separate configurations:

**Development Configuration:**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 600000,
      "debug": true
    }
  }
}
```

**Production Configuration:**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://hx-coderabbit-server.hx.dev.local:8005/sse",
      "timeout": 300000
    }
  }
}
```

**Switch between configurations:**
```bash
# Use symlinks for easy switching
ln -sf ~/.config/claude-code/config.production.json ~/.config/claude-code/config.json

# Or use environment variable (if supported)
export CLAUDE_CODE_CONFIG=~/.config/claude-code/config.production.json
```

### 4.6 Configuration Validation

After editing the configuration, validate the JSON syntax:

```bash
# Validate JSON syntax using Python
python3 -c "
import json
with open('~/.config/claude-code/config.json'.replace('~', '$HOME')) as f:
    config = json.load(f)
    print('âœ… Configuration is valid JSON')
    print(json.dumps(config, indent=2))
"

# Or use jq (if installed)
jq . ~/.config/claude-code/config.json

# Or use a simple cat and visual inspection
cat ~/.config/claude-code/config.json
```

**Common JSON Errors to Avoid:**
- Missing commas between entries
- Trailing comma after last entry
- Unquoted keys or values
- Incorrect bracket/brace matching
- Special characters not properly escaped

---

## 5. Connection Testing

### 5.1 Verify Configuration Loaded

After saving the configuration, restart Claude Code or reload the configuration:

```bash
# Method 1: Restart Claude Code (if running as service)
systemctl --user restart claude-code

# Method 2: Kill and restart Claude Code process
pkill claude-code
claude-code &

# Method 3: Use Claude Code CLI to reload config (if available)
claude-code reload-config
```

### 5.2 Test Connection from Claude Code

Open Claude Code and test the connection:

**Method 1: Direct Tool Call (if supported)**
```
User: List available MCP tools from Roger
Claude: [Should list Roger's tools: roger_review, etc.]
```

**Method 2: Use Roger Directly**
```
User: Use Roger to review this file: test.py
Claude: [Should connect to Roger and perform review]
```

**Method 3: Check MCP Server Status (if supported)**
```
User: Show status of MCP servers
Claude: [Should show Roger as connected]
```

### 5.3 Manual Connection Testing

Test the connection manually using curl:

```bash
# Test basic HTTP connectivity
curl -v http://192.168.10.228:8005/health

# Expected response:
# HTTP/1.1 200 OK
# Content-Type: application/json
# {"status":"healthy","version":"4.0.0","timestamp":"..."}

# Test SSE endpoint (connection test)
curl -N -H "Accept: text/event-stream" http://192.168.10.228:8005/sse

# Expected: SSE stream starts (connection stays open)
# Press Ctrl+C to stop

# Test MCP protocol handshake (advanced)
curl -X POST http://192.168.10.228:8005/sse \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05",
      "capabilities": {},
      "clientInfo": {
        "name": "test-client",
        "version": "1.0.0"
      }
    }
  }'

# Expected: JSON response with server capabilities
```

### 5.4 Connection Test Script

Create a comprehensive connection test script:

```bash
# Create test script
cat > ~/test-roger-connection.sh <<'EOF'
#!/bin/bash
# Roger MCP Server Connection Test Script
# Tests connectivity from client to Roger MCP server

set -e

ROGER_HOST="192.168.10.228"
ROGER_PORT="8005"
ROGER_FQDN="hx-coderabbit-server.hx.dev.local"
ROGER_URL="http://${ROGER_HOST}:${ROGER_PORT}"

echo "=== Roger MCP Server Connection Test ==="
echo "Server: ${ROGER_HOST}:${ROGER_PORT}"
echo "FQDN: ${ROGER_FQDN}"
echo ""

# Test 1: DNS Resolution
echo "Test 1: DNS Resolution"
if nslookup ${ROGER_FQDN} >/dev/null 2>&1; then
    RESOLVED_IP=$(nslookup ${ROGER_FQDN} | grep -A1 "Name:" | grep "Address:" | awk '{print $2}')
    echo "âœ… PASS: DNS resolves ${ROGER_FQDN} to ${RESOLVED_IP}"
else
    echo "âŒ FAIL: DNS resolution failed for ${ROGER_FQDN}"
    exit 1
fi
echo ""

# Test 2: Network Connectivity (ICMP)
echo "Test 2: Network Connectivity (ICMP)"
if ping -c 3 -W 2 ${ROGER_HOST} >/dev/null 2>&1; then
    echo "âœ… PASS: Can ping ${ROGER_HOST}"
else
    echo "âŒ FAIL: Cannot ping ${ROGER_HOST}"
    exit 1
fi
echo ""

# Test 3: Port Connectivity (TCP)
echo "Test 3: Port Connectivity (TCP)"
if nc -zv ${ROGER_HOST} ${ROGER_PORT} 2>&1 | grep -q "succeeded"; then
    echo "âœ… PASS: Port ${ROGER_PORT} is reachable"
else
    echo "âŒ FAIL: Port ${ROGER_PORT} is not reachable"
    exit 1
fi
echo ""

# Test 4: HTTP Health Endpoint
echo "Test 4: HTTP Health Endpoint"
HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" ${ROGER_URL}/health)
if [ "$HTTP_STATUS" == "200" ]; then
    HEALTH_RESPONSE=$(curl -s ${ROGER_URL}/health)
    echo "âœ… PASS: Health endpoint returned 200 OK"
    echo "   Response: ${HEALTH_RESPONSE}"
else
    echo "âŒ FAIL: Health endpoint returned ${HTTP_STATUS}"
    exit 1
fi
echo ""

# Test 5: SSE Endpoint
echo "Test 5: SSE Endpoint"
timeout 5 curl -N -H "Accept: text/event-stream" ${ROGER_URL}/sse >/dev/null 2>&1
if [ $? -eq 124 ]; then  # timeout exit code = connection successful
    echo "âœ… PASS: SSE endpoint is accepting connections"
else
    echo "âŒ FAIL: SSE endpoint connection failed"
    exit 1
fi
echo ""

# Test 6: Claude Code Configuration
echo "Test 6: Claude Code Configuration"
CONFIG_FILE="${HOME}/.config/claude-code/config.json"
if [ -f "$CONFIG_FILE" ]; then
    if grep -q "roger" "$CONFIG_FILE" && grep -q "${ROGER_HOST}" "$CONFIG_FILE"; then
        echo "âœ… PASS: Roger configured in Claude Code"
    else
        echo "âš ï¸  WARN: Roger not found in Claude Code config"
    fi
else
    echo "âš ï¸  WARN: Claude Code config file not found at ${CONFIG_FILE}"
fi
echo ""

echo "=== Connection Test Complete ==="
echo "âœ… All critical tests passed"
echo "Roger MCP server is accessible from this client"
EOF

# Make script executable
chmod +x ~/test-roger-connection.sh

# Run test script
~/test-roger-connection.sh
```

### 5.5 Expected Test Results

When all tests pass, you should see:

```
=== Roger MCP Server Connection Test ===
Server: 192.168.10.228:8005
FQDN: hx-coderabbit-server.hx.dev.local

Test 1: DNS Resolution
âœ… PASS: DNS resolves hx-coderabbit-server.hx.dev.local to 192.168.10.228

Test 2: Network Connectivity (ICMP)
âœ… PASS: Can ping 192.168.10.228

Test 3: Port Connectivity (TCP)
âœ… PASS: Port 8005 is reachable

Test 4: HTTP Health Endpoint
âœ… PASS: Health endpoint returned 200 OK
   Response: {"status":"healthy","version":"4.0.0","timestamp":"2025-11-11T12:00:00Z"}

Test 5: SSE Endpoint
âœ… PASS: SSE endpoint is accepting connections

Test 6: Claude Code Configuration
âœ… PASS: Roger configured in Claude Code

=== Connection Test Complete ===
âœ… All critical tests passed
Roger MCP server is accessible from this client
```

---

## 6. Multi-Server Deployment

### 6.1 Deployment Strategy

For deploying Roger client configuration across multiple Hana-X servers:

**Manual Deployment (Small Scale):**
- Configure each server individually using steps in Section 4
- Suitable for 1-5 servers
- Good for testing and validation

**Automated Deployment (Large Scale):**
- Use Ansible from hx-control-node (192.168.10.203)
- Deploy to all servers simultaneously
- Suitable for 10+ servers
- Ensures consistency

### 6.2 Target Servers for Roger Client

Recommended servers for Roger client configuration:

| Server | IP | Priority | Rationale |
|--------|----|----|-----------|
| **hx-cc-server** | 192.168.10.224 | âš¡ Critical | Primary Claude Code server, integration hub |
| **hx-dev-server** | 192.168.10.222 | âš¡ Critical | Development environment |
| **hx-demo-server** | 192.168.10.223 | ğŸ”¹ High | Demo environment for showcasing Roger |
| **hx-webui-server** | 192.168.10.227 | ğŸ”¹ High | Web interface may integrate Roger |
| **hx-lang-server** | 192.168.10.226 | ğŸ”¸ Medium | LangChain workflows may use Roger |
| **hx-control-node** | 192.168.10.203 | ğŸ”¸ Medium | Infrastructure management, testing |
| **Other servers** | Various | ğŸ”» Low | As needed for specific use cases |

### 6.3 Ansible Deployment Playbook

Create an Ansible playbook for automated deployment:

```yaml
# File: /srv/ansible/playbooks/deploy-roger-client.yml
# Deploy Roger MCP client configuration to Hana-X servers
---
- name: Deploy Roger MCP Client Configuration
  hosts: claude_code_servers
  become: yes
  become_user: "{{ target_user }}"
  
  vars:
    roger_mcp_host: "192.168.10.228"
    roger_mcp_port: "8005"
    roger_mcp_fqdn: "hx-coderabbit-server.hx.dev.local"
    claude_code_config_dir: "{{ ansible_env.HOME }}/.config/claude-code"
    claude_code_config_file: "{{ claude_code_config_dir }}/config.json"
    backup_suffix: ".backup-{{ ansible_date_time.epoch }}"
  
  tasks:
    - name: Verify Roger MCP server is accessible
      uri:
        url: "http://{{ roger_mcp_host }}:{{ roger_mcp_port }}/health"
        method: GET
        return_content: yes
        status_code: 200
      register: health_check
      delegate_to: localhost
      run_once: true
    
    - name: Display Roger server status
      debug:
        msg: "Roger MCP server is healthy: {{ health_check.json }}"
      run_once: true
    
    - name: Ensure Claude Code config directory exists
      file:
        path: "{{ claude_code_config_dir }}"
        state: directory
        mode: '0755'
    
    - name: Check if config file exists
      stat:
        path: "{{ claude_code_config_file }}"
      register: config_exists
    
    - name: Backup existing configuration
      copy:
        src: "{{ claude_code_config_file }}"
        dest: "{{ claude_code_config_file }}{{ backup_suffix }}"
        remote_src: yes
      when: config_exists.stat.exists
    
    - name: Load existing configuration
      slurp:
        src: "{{ claude_code_config_file }}"
      register: existing_config
      when: config_exists.stat.exists
    
    - name: Parse existing configuration
      set_fact:
        config_data: "{{ existing_config.content | b64decode | from_json }}"
      when: config_exists.stat.exists
    
    - name: Initialize empty configuration
      set_fact:
        config_data:
          mcpServers: {}
      when: not config_exists.stat.exists
    
    - name: Add Roger to MCP servers
      set_fact:
        config_data: "{{ config_data | combine({'mcpServers': config_data.mcpServers | combine({'roger': roger_config})}, recursive=True) }}"
      vars:
        roger_config:
          transport: "sse"
          url: "http://{{ roger_mcp_host }}:{{ roger_mcp_port }}/sse"
          timeout: 300000
    
    - name: Write updated configuration
      copy:
        content: "{{ config_data | to_nice_json }}"
        dest: "{{ claude_code_config_file }}"
        mode: '0644'
    
    - name: Validate JSON configuration
      command: "python3 -c 'import json; json.load(open(\"{{ claude_code_config_file }}\"))'"
      changed_when: false
    
    - name: Test Roger connectivity from client
      uri:
        url: "http://{{ roger_mcp_host }}:{{ roger_mcp_port }}/health"
        method: GET
        status_code: 200
      register: client_connectivity_test
    
    - name: Display configuration result
      debug:
        msg: "âœ… Roger MCP client configured successfully on {{ inventory_hostname }}"

```

**Inventory File:**
```ini
# File: /srv/ansible/inventory/hana-x-servers.ini
[claude_code_servers]
hx-cc-server ansible_host=192.168.10.224 target_user=agent0
hx-dev-server ansible_host=192.168.10.222 target_user=developer
hx-demo-server ansible_host=192.168.10.223 target_user=demo
hx-webui-server ansible_host=192.168.10.227 target_user=webui

[claude_code_servers:vars]
ansible_python_interpreter=/usr/bin/python3
```

**Run Playbook:**
```bash
# From hx-control-node (192.168.10.203)
cd /srv/ansible

# Test connectivity first (dry run)
ansible claude_code_servers -i inventory/hana-x-servers.ini -m ping

# Deploy to all servers
ansible-playbook -i inventory/hana-x-servers.ini playbooks/deploy-roger-client.yml

# Deploy to specific server
ansible-playbook -i inventory/hana-x-servers.ini playbooks/deploy-roger-client.yml --limit hx-cc-server

# Deploy with verbose output
ansible-playbook -i inventory/hana-x-servers.ini playbooks/deploy-roger-client.yml -vv
```

### 6.4 Verification After Multi-Server Deployment

After deploying to multiple servers, verify each one:

```bash
# From hx-control-node, run connection test on all servers
ansible claude_code_servers -i inventory/hana-x-servers.ini -a "curl -s http://192.168.10.228:8005/health"

# Expected: Health check response from each server

# Check configuration on all servers
ansible claude_code_servers -i inventory/hana-x-servers.ini -a "cat ~/.config/claude-code/config.json"

# Verify Roger entry present in all configurations
```

---

## 7. Usage Examples

### 7.1 Basic Usage in Claude Code

Once configured, you can use Roger directly from Claude Code's natural language interface:

**Example 1: Review Current Directory**
```
User: Use Roger to review the code in the current directory

Claude: I'll use Roger to perform a comprehensive code review.

[Claude calls Roger MCP tool: roger_review with path=./]

Roger found the following issues:
- [Layer 1 - bandit] High severity: Hardcoded password in config.py:42
- [Layer 1 - pylint] Code smell: Function too long in utils.py:100
- [Layer 3 - CodeRabbit] Suggestion: Consider using async/await in api.py
...
```

**Example 2: Review Specific File**
```
User: Run Roger on src/main.py

Claude: I'll review src/main.py using Roger.

[Claude calls Roger MCP tool]

Code review results for src/main.py:
âœ… No security issues found (bandit)
âš ï¸  3 style issues (pylint)
â„¹ï¸  CodeRabbit suggests improving error handling
...
```

**Example 3: Layer-Specific Review**
```
User: Use Roger with only Layer 1 linters on this file

Claude: I'll run Roger's Layer 1 linters (bandit, pylint, mypy, radon, flake8, vulture) on the current file.

[Claude calls Roger with layer3_enabled=false]

Layer 1 Analysis Results:
- Security: 0 issues
- Style: 5 issues
- Type hints: 2 warnings
- Complexity: Acceptable (cyclomatic complexity: 8)
...
```

### 7.2 Workflow Examples

**Workflow 1: Pre-Commit Review**
```bash
# Developer workflow before committing code

# 1. Make changes to code
vim src/feature.py

# 2. Ask Claude to review via Roger
# In Claude Code:
User: Review my changes before I commit them

Claude: [Uses Roger to review uncommitted changes]
Found 2 issues that should be fixed before commit:
- Line 45: Variable 'temp' is never used
- Line 60: Missing type hint for return value

# 3. Fix issues
vim src/feature.py

# 4. Re-review
User: Check if I fixed those issues

Claude: [Uses Roger again]
âœ… All issues resolved. Code is ready to commit.

# 5. Commit
git commit -m "Add new feature"
```

**Workflow 2: Continuous Integration**
```bash
# CI/CD pipeline integration

# In .gitlab-ci.yml or .github/workflows/main.yml
- name: Code Review with Roger
  run: |
    # Call Roger MCP server directly via curl
    curl -X POST http://192.168.10.228:8005/tools/call \
      -H "Content-Type: application/json" \
      -d '{
        "tool": "roger_review",
        "params": {
          "path": ".",
          "enable_layer3": true
        }
      }' > review-results.json
    
    # Fail build if critical issues found
    if grep -q "severity.*critical" review-results.json; then
      echo "Critical issues found, failing build"
      exit 1
    fi
```

**Workflow 3: Multi-Project Review**
```
User: Review all Python projects in /srv/projects/

Claude: I'll use Roger to review each Python project.

[Claude iterates through projects, calling Roger for each]

Review Summary:
1. project-a: âœ… Clean (0 issues)
2. project-b: âš ï¸ 12 issues (3 high, 9 medium)
3. project-c: âœ… Clean (0 issues)
4. project-d: âŒ 45 issues (5 critical, 15 high, 25 medium)

Would you like me to show details for any specific project?
```

### 7.3 Advanced Usage

**Example 4: Comparing Code Quality**
```
User: Compare code quality between v1.0 branch and main branch

Claude: I'll use Roger to review both branches and compare results.

[Claude checks out v1.0, calls Roger]
v1.0 branch: 23 issues total

[Claude checks out main, calls Roger]
main branch: 15 issues total

Improvement: 8 fewer issues in main branch (35% improvement)

Key improvements:
- Security issues reduced from 3 to 0
- Code complexity improved
- Type coverage increased from 60% to 85%
```

**Example 5: Custom Review Parameters**
```
User: Use Roger with Layer 3 cache disabled and 2-minute timeout

Claude: I'll configure Roger with custom parameters.

[Claude calls Roger with:
  layer3_cache_enabled=false,
  layer3_timeout=120
]

Running fresh CodeRabbit analysis (cache disabled)...
Review completed in 95 seconds.
...
```

**Example 6: Batch Processing**
```
User: Review all modified files in the last 3 commits

Claude: I'll identify modified files and review them with Roger.

[Claude runs: git diff HEAD~3 --name-only]
Found 8 modified files.

[Claude calls Roger for each file]

Batch review results:
- src/api.py: âœ… 0 issues
- src/models.py: âš ï¸ 2 issues
- src/utils.py: âœ… 0 issues
- tests/test_api.py: âš ï¸ 1 issue
...

Total: 7 issues across 8 files
```

### 7.4 Integration with Other Tools

**Example 7: Combining Roger with Other MCP Tools**
```
User: Crawl the project documentation, then review the code with Roger, then generate a quality report

Claude: I'll execute this workflow in three steps:

Step 1: Crawling documentation with Crawl4AI MCP...
[Uses Crawl4AI MCP server]

Step 2: Reviewing code with Roger...
[Uses Roger MCP server]

Step 3: Generating report...
[Combines results]

Quality Report Generated:
- Documentation coverage: 85%
- Code issues found: 12
- Test coverage: 78%
- Recommendations: [list]
```

---

## 8. Troubleshooting

### 8.1 Common Issues

| Issue | Symptoms | Diagnostic | Resolution |
|-------|----------|------------|------------|
| **Connection refused** | Cannot connect to Roger | `curl http://192.168.10.228:8005/health` fails | Verify Roger MCP server is running: `ssh hx-coderabbit-server sudo systemctl status roger-mcp` |
| **Timeout errors** | Requests time out | Requests hang, no response | Increase timeout in config: `"timeout": 600000` (10 minutes) |
| **Invalid JSON** | Configuration not loaded | Claude Code doesn't recognize Roger | Validate JSON: `jq . ~/.config/claude-code/config.json` |
| **DNS resolution failure** | Cannot resolve FQDN | `nslookup hx-coderabbit-server.hx.dev.local` fails | Check `/etc/resolv.conf`, ensure `nameserver 192.168.10.200` |
| **Network unreachable** | Cannot reach 192.168.10.228 | `ping 192.168.10.228` fails | Check network connectivity, routing: `ip route show` |
| **Port blocked** | Port 8005 not accessible | `nc -zv 192.168.10.228 8005` fails | Check firewall rules on both client and server |
| **Permission denied** | Cannot modify config file | `Permission denied` when editing config | Check file ownership: `ls -la ~/.config/claude-code/config.json` |
| **Claude Code not recognizing Roger** | Roger tools not available | Claude doesn't list Roger tools | Restart Claude Code, check logs for errors |
| **SSL/TLS errors** | HTTPS connection fails | Certificate validation errors | Use HTTP (not HTTPS) for Phase 4.0. HTTPS in Phase 4.1 |
| **MCP protocol mismatch** | Incompatible version errors | Error messages about protocol version | Ensure Roger and Claude Code use compatible MCP versions |

### 8.2 Diagnostic Commands

**Network Diagnostics:**
```bash
# Full network diagnostic
echo "=== Network Diagnostics ==="

# DNS
nslookup hx-coderabbit-server.hx.dev.local
dig hx-coderabbit-server.hx.dev.local

# Connectivity
ping -c 5 192.168.10.228
traceroute 192.168.10.228

# Port access
nc -zv 192.168.10.228 8005
telnet 192.168.10.228 8005

# Routing
ip route show
ip route get 192.168.10.228

# Firewall
sudo iptables -L -n -v | grep 8005
sudo ufw status | grep 8005
```

**Configuration Diagnostics:**
```bash
# Claude Code configuration
echo "=== Configuration Diagnostics ==="

# Find config file
find ~ -name "config.json" -path "*claude-code*"

# Validate JSON
python3 -c "
import json
with open('$HOME/.config/claude-code/config.json') as f:
    config = json.load(f)
    print('Valid JSON')
    print('MCP Servers:', list(config.get('mcpServers', {}).keys()))
"

# Check file permissions
ls -la ~/.config/claude-code/config.json

# View configuration
cat ~/.config/claude-code/config.json
```

**Roger Server Diagnostics (Remote):**
```bash
# From client server, diagnose Roger server
echo "=== Roger Server Diagnostics ==="

# Health check
curl -v http://192.168.10.228:8005/health

# Test SSE endpoint
timeout 3 curl -N http://192.168.10.228:8005/sse

# Check server logs (requires SSH access)
ssh agent0@hx-coderabbit-server sudo journalctl -u roger-mcp.service -n 50

# Check server status (requires SSH access)
ssh agent0@hx-coderabbit-server sudo systemctl status roger-mcp.service
```

### 8.3 Debug Mode

Enable debug logging in Claude Code (if supported):

```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000,
      "debug": true,
      "logLevel": "debug"
    }
  },
  "logging": {
    "level": "debug",
    "file": "~/.config/claude-code/debug.log"
  }
}
```

View debug logs:
```bash
tail -f ~/.config/claude-code/debug.log
```

### 8.4 Troubleshooting Checklist

Work through this checklist systematically:

- [ ] **1. Verify Roger server is running**
  ```bash
  ssh hx-coderabbit-server sudo systemctl status roger-mcp.service
  ```

- [ ] **2. Test network connectivity**
  ```bash
  ping -c 3 192.168.10.228
  nc -zv 192.168.10.228 8005
  ```

- [ ] **3. Test DNS resolution**
  ```bash
  nslookup hx-coderabbit-server.hx.dev.local
  ```

- [ ] **4. Test HTTP endpoint**
  ```bash
  curl http://192.168.10.228:8005/health
  ```

- [ ] **5. Validate configuration file**
  ```bash
  jq . ~/.config/claude-code/config.json
  ```

- [ ] **6. Check file permissions**
  ```bash
  ls -la ~/.config/claude-code/config.json
  ```

- [ ] **7. Restart Claude Code**
  ```bash
  pkill claude-code
  claude-code &
  ```

- [ ] **8. Check Claude Code logs**
  ```bash
  tail -f ~/.config/claude-code/logs/*.log
  ```

- [ ] **9. Test with curl manually**
  ```bash
  ~/test-roger-connection.sh
  ```

- [ ] **10. Contact support if issues persist**

### 8.5 Getting Help

If troubleshooting doesn't resolve the issue:

**Internal Resources:**
1. Check Roger server logs: `ssh hx-coderabbit-server sudo journalctl -u roger-mcp.service`
2. Review Roger documentation: `/opt/roger/docs/PHASE4-PREREQUISITES-SETUP.md`
3. Contact Agent Zero for orchestration support

**External Resources:**
1. MCP Protocol Documentation: https://modelcontextprotocol.io
2. Claude Code Documentation: https://docs.anthropic.com/claude-code
3. Network debugging: Hana-X network topology docs

---

## 9. Security Considerations

### 9.1 Phase 4.0 Security Model

**Current State (Phase 4.0):**
- âœ… Internal network only (192.168.10.0/24)
- âœ… No public internet exposure
- âŒ No authentication (trusted network)
- âŒ No encryption (HTTP, not HTTPS)
- âš ï¸ Relies on network perimeter security

**Risk Assessment:**
- **Low Risk**: Internal development network with trusted users
- **Medium Risk**: No authentication means any internal user can access
- **Mitigation**: Network isolation, firewall rules

### 9.2 Network Security

**Firewall Rules (Client Side):**

If you have a firewall enabled on the client server, ensure outbound connections to Roger are allowed:

```bash
# Allow outbound to Roger MCP server
sudo ufw allow out to 192.168.10.228 port 8005 proto tcp comment 'Roger MCP client'

# Or use iptables
sudo iptables -A OUTPUT -d 192.168.10.228 -p tcp --dport 8005 -j ACCEPT
```

**Firewall Rules (Server Side):**

See PHASE4-PREREQUISITES-SETUP.md for server-side firewall configuration.

### 9.3 Configuration File Security

The Claude Code configuration file may contain sensitive information in the future (Phase 4.1: API keys). Protect it now:

```bash
# Set restrictive permissions
chmod 600 ~/.config/claude-code/config.json

# Verify permissions
ls -la ~/.config/claude-code/config.json
# Should show: -rw------- (only owner can read/write)

# Ensure config directory is protected
chmod 700 ~/.config/claude-code
```

### 9.4 Phase 4.1 Security Enhancements (Future)

**Planned Security Improvements:**

1. **Kerberos Authentication**
   - Client authenticates to hx-dc-server (192.168.10.200)
   - Obtains Kerberos ticket
   - Presents ticket to Roger MCP server
   - Roger validates ticket with KDC

2. **TLS/HTTPS Encryption**
   - Certificates from hx-ca-server (192.168.10.201)
   - All traffic encrypted in transit
   - URL changes to: `https://hx-coderabbit-server.hx.dev.local:8005/sse`

3. **API Key Authentication (Backup)**
   - Per-client API keys
   - Keys stored in configuration
   - Server validates keys before processing requests

4. **Rate Limiting (Per-Client)**
   - Prevent abuse
   - Fair resource allocation
   - Tracked by client identity

**Phase 4.1 Configuration (Future):**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "https://hx-coderabbit-server.hx.dev.local:8005/sse",
      "timeout": 300000,
      "auth": {
        "type": "kerberos",
        "realm": "HX.DEV.LOCAL",
        "service": "HTTP/hx-coderabbit-server.hx.dev.local"
      },
      "tls": {
        "verify": true,
        "ca_cert": "/etc/ssl/certs/hx-ca.pem"
      }
    }
  }
}
```

### 9.5 Best Security Practices

1. **Least Privilege**: Only configure Roger on servers that need it
2. **Audit Logging**: Monitor Roger access (Phase 4.1)
3. **Regular Updates**: Keep Roger server updated
4. **Network Segmentation**: Maintain 192.168.10.0/24 isolation
5. **Configuration Protection**: Restrict config file permissions (600)
6. **Credential Management**: Never hardcode secrets (use environment variables in Phase 4.1)

---

## 10. Best Practices

### 10.1 Configuration Management

**Use Version Control:**
```bash
# Store configuration in version control
git init ~/.config/claude-code
cd ~/.config/claude-code
git add config.json
git commit -m "Add Roger MCP server configuration"

# Push to private repository (recommended)
git remote add origin git@github.com:your-org/claude-code-configs.git
git push -u origin main
```

**Use Configuration Templates:**
```bash
# Create template for consistent deployments
cat > ~/.config/claude-code/config.template.json <<'EOF'
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://{{ROGER_HOST}}:{{ROGER_PORT}}/sse",
      "timeout": 300000
    }
  }
}
EOF

# Generate configuration from template
sed -e 's/{{ROGER_HOST}}/192.168.10.228/g' \
    -e 's/{{ROGER_PORT}}/8005/g' \
    config.template.json > config.json
```

### 10.2 Performance Optimization

**Adjust Timeouts Based on Usage:**

- **Fast linters only (Layer 1)**: 60 seconds
  ```json
  {"timeout": 60000}
  ```

- **Layer 1 + Layer 3 (CodeRabbit)**: 5 minutes (default)
  ```json
  {"timeout": 300000}
  ```

- **Large codebases**: 10 minutes
  ```json
  {"timeout": 600000}
  ```

**Connection Pooling (if supported):**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000,
      "pool": {
        "maxConnections": 5,
        "keepAlive": true
      }
    }
  }
}
```

### 10.3 Monitoring and Logging

**Client-Side Logging:**
```bash
# Enable client logging (if supported)
export CLAUDE_CODE_LOG_LEVEL=info
export CLAUDE_CODE_LOG_FILE=~/.config/claude-code/client.log

# View logs
tail -f ~/.config/claude-code/client.log
```

**Monitor Roger Usage:**
```bash
# From Roger server, monitor active connections
ssh hx-coderabbit-server sudo journalctl -u roger-mcp.service -f | grep "connection"

# Count active clients
ssh hx-coderabbit-server "sudo netstat -tn | grep ':8005' | wc -l"
```

### 10.4 Maintenance

**Regular Configuration Backup:**
```bash
# Automated backup script
cat > ~/backup-claude-config.sh <<'EOF'
#!/bin/bash
# Backup Claude Code configuration

BACKUP_DIR=~/.config/claude-code/backups
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
cp ~/.config/claude-code/config.json $BACKUP_DIR/config-$DATE.json

# Keep only last 10 backups
ls -t $BACKUP_DIR/config-*.json | tail -n +11 | xargs rm -f

echo "Backup created: $BACKUP_DIR/config-$DATE.json"
EOF

chmod +x ~/backup-claude-config.sh

# Run backup
~/backup-claude-config.sh

# Schedule daily backup (cron)
(crontab -l 2>/dev/null; echo "0 2 * * * ~/backup-claude-config.sh") | crontab -
```

**Configuration Validation:**
```bash
# Automated validation script
cat > ~/validate-claude-config.sh <<'EOF'
#!/bin/bash
# Validate Claude Code configuration

CONFIG_FILE=~/.config/claude-code/config.json

# Check file exists
if [ ! -f "$CONFIG_FILE" ]; then
    echo "âŒ Configuration file not found"
    exit 1
fi

# Validate JSON syntax
if ! python3 -c "import json; json.load(open('$CONFIG_FILE'))" 2>/dev/null; then
    echo "âŒ Invalid JSON syntax"
    exit 1
fi

# Check Roger is configured
if ! grep -q '"roger"' "$CONFIG_FILE"; then
    echo "âš ï¸  Warning: Roger not found in configuration"
fi

# Test Roger connectivity
if curl -s -f http://192.168.10.228:8005/health >/dev/null; then
    echo "âœ… Configuration valid and Roger is accessible"
    exit 0
else
    echo "âŒ Roger MCP server not accessible"
    exit 1
fi
EOF

chmod +x ~/validate-claude-config.sh

# Run validation
~/validate-claude-config.sh
```

### 10.5 Documentation

**Document Your Deployment:**

Create a local documentation file for your specific setup:

```bash
cat > ~/.config/claude-code/README.md <<'EOF'
# Claude Code Configuration - Roger MCP Client

## Server Information
- **Roger MCP Server**: hx-coderabbit-server.hx.dev.local (192.168.10.228:8005)
- **Configured Date**: 2025-11-11
- **Configured By**: Agent Zero

## Configuration
- **File**: ~/.config/claude-code/config.json
- **Transport**: SSE (Server-Sent Events)
- **Timeout**: 300 seconds (5 minutes)

## Usage
See: /opt/roger/docs/PHASE4-CLIENT-CONFIGURATION.md

## Troubleshooting
1. Test connection: `~/test-roger-connection.sh`
2. Check logs: `tail -f ~/.config/claude-code/client.log`
3. Validate config: `~/validate-claude-config.sh`

## Contacts
- Server Admin: Agent Zero
- Roger Server: hx-coderabbit-server.hx.dev.local
EOF
```

---

## 11. Appendix

### 11.1 Complete Configuration Examples

**Minimal Configuration:**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse"
    }
  }
}
```

**Standard Configuration:**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000
    }
  }
}
```

**Advanced Configuration:**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://hx-coderabbit-server.hx.dev.local:8005/sse",
      "timeout": 300000,
      "retries": 3,
      "retryDelay": 1000,
      "keepAlive": true,
      "headers": {
        "User-Agent": "claude-code-client/1.0",
        "X-Client-ID": "hx-cc-server"
      }
    }
  }
}
```

**Multi-Server Configuration (Roger + Others):**
```json
{
  "mcpServers": {
    "roger": {
      "transport": "sse",
      "url": "http://192.168.10.228:8005/sse",
      "timeout": 300000
    },
    "fastmcp": {
      "transport": "sse",
      "url": "http://192.168.10.213:8000/sse",
      "timeout": 60000
    },
    "qdrant-mcp": {
      "transport": "sse",
      "url": "http://192.168.10.211:8004/sse",
      "timeout": 120000
    }
  }
}
```

### 11.2 Quick Reference

**Key URLs:**
| Resource | URL |
|----------|-----|
| Roger MCP Server (IP) | http://192.168.10.228:8005 |
| Roger MCP Server (FQDN) | http://hx-coderabbit-server.hx.dev.local:8005 |
| Roger SSE Endpoint | http://192.168.10.228:8005/sse |
| Roger Health Check | http://192.168.10.228:8005/health |

**Key Files:**
| File | Purpose |
|------|---------|
| `~/.config/claude-code/config.json` | Claude Code MCP configuration |
| `~/test-roger-connection.sh` | Connection test script |
| `~/validate-claude-config.sh` | Configuration validation script |
| `~/backup-claude-config.sh` | Configuration backup script |

**Key Commands:**
```bash
# Test connection
curl http://192.168.10.228:8005/health

# Validate configuration
jq . ~/.config/claude-code/config.json

# Run connection test
~/test-roger-connection.sh

# View Claude Code config
cat ~/.config/claude-code/config.json

# Restart Claude Code
pkill claude-code && claude-code &
```

### 11.3 Troubleshooting Quick Reference

| Symptom | Quick Fix |
|---------|-----------|
| Connection refused | Check Roger server: `ssh hx-coderabbit-server sudo systemctl status roger-mcp` |
| DNS failure | Add to /etc/hosts: `192.168.10.228 hx-coderabbit-server.hx.dev.local` |
| Invalid JSON | Validate: `jq . ~/.config/claude-code/config.json` |
| Timeout | Increase timeout in config: `"timeout": 600000` |
| Permission denied | Fix permissions: `chmod 600 ~/.config/claude-code/config.json` |

### 11.4 Deployment Checklist

Quick deployment checklist for new client:

- [ ] Verify Roger server running
- [ ] Test network connectivity (`ping 192.168.10.228`)
- [ ] Test port access (`nc -zv 192.168.10.228 8005`)
- [ ] Test HTTP endpoint (`curl http://192.168.10.228:8005/health`)
- [ ] Create config directory (`mkdir -p ~/.config/claude-code`)
- [ ] Create configuration file (see Section 4.2)
- [ ] Validate JSON syntax (`jq . config.json`)
- [ ] Set file permissions (`chmod 600 config.json`)
- [ ] Restart Claude Code
- [ ] Test Roger usage (see Section 7.1)
- [ ] Document deployment (see Section 10.5)

### 11.5 Support Resources

**Internal Documentation:**
- PHASE4-PREREQUISITES-SETUP.md - Roger server setup
- POC4-PHASE3-COMPLETION-REPORT.md - Roger implementation details
- 0.0.2.3-network-topology.md - Hana-X network architecture

**External Documentation:**
- MCP Protocol: https://modelcontextprotocol.io
- Claude Code: https://docs.anthropic.com/claude-code
- SSE Specification: https://html.spec.whatwg.org/multipage/server-sent-events.html

**Support Contacts:**
- Agent Zero: System orchestration, general support
- Roger Service: hx-coderabbit-server.hx.dev.local
- Network Infrastructure: hx-control-node.hx.dev.local

---

## Document Maintenance

### Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2025-11-11 | Initial client configuration documentation | Claude Code (Agent Zero collaboration) |

### Related Documents

- **PHASE4-PREREQUISITES-SETUP.md** - Server prerequisites and setup
- **PHASE4-IMPLEMENTATION.md** - Roger HTTP MCP implementation (to be created)
- **PHASE4-DEPLOYMENT.md** - Server deployment procedures (to be created)
- **POC4-PHASE3-COMPLETION-REPORT.md** - Roger Phase 3 completion status
- **0.0.2.3-network-topology.md** - Network architecture reference

### Document Status

**Status**: âœ… COMPLETE - Client Configuration Ready  
**Phase**: 4.0 Client Configuration  
**Target Audience**: System Administrators, Developers  
**Approval**: Pending Agent Zero review  
**Classification**: Internal - Technical Documentation

---

**End of Client Configuration Document**

*This document provides comprehensive instructions for configuring Claude Code clients across the Hana-X infrastructure to connect to the Roger MCP server. Follow these steps to enable distributed code review capabilities via the Model Context Protocol.*
